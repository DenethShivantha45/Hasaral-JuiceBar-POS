<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hasaral Fruits & Juice Bar | Creative POS</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&family=Courier+Prime&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #FF4757;
            --secondary: #2ED573;
            --accent: #FFA502;
            --dark: #2F3542;
            --glass: rgba(255, 255, 255, 0.9);
            --shadow: 0 8px 32px rgba(0,0,0,0.1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Outfit', sans-serif; }

        body {
            background: #f1f2f6;
            min-height: 100vh;
            display: flex;
            color: var(--dark);
        }

        /* --- AUTH SCREEN --- */
        #auth-screen {
            position: fixed; inset: 0; background: linear-gradient(45deg, #FF4757, #FFA502);
            display: flex; align-items: center; justify-content: center; z-index: 10000;
        }
        .auth-card {
            background: white; padding: 40px; border-radius: 24px; box-shadow: var(--shadow);
            width: 100%; max-width: 400px; text-align: center;
        }

        /* --- SIDEBAR --- */
        #sidebar {
            width: 280px; background: var(--dark); color: white;
            padding: 30px 20px; display: flex; flex-direction: column;
        }
        .nav-link {
            padding: 15px 20px; border-radius: 12px; cursor: pointer;
            margin-bottom: 10px; transition: 0.3s; color: #a4b0be; font-weight: 600;
        }
        .nav-link.active { background: var(--primary); color: white; }

        /* --- CONTENT --- */
        #main-content { flex: 1; padding: 30px; overflow-y: auto; height: 100vh; }
        .page { display: none; animation: fadeIn 0.4s ease; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* --- DASHBOARD --- */
        .stat-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: white; padding: 25px; border-radius: 20px; box-shadow: var(--shadow); }
        .chart-box { background: white; padding: 25px; border-radius: 24px; margin-bottom: 30px; }

        /* --- BILLING LAYOUT --- */
        .billing-container { display: grid; grid-template-columns: 1fr 380px; gap: 25px; }
        .product-selector { background: white; padding: 25px; border-radius: 24px; box-shadow: var(--shadow); }
        
        .item-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 15px; }
        .item-card { 
            background: #f8f9fa; padding: 15px; border-radius: 15px; text-align: center; 
            cursor: pointer; border: 2px solid transparent; transition: 0.2s;
        }
        .item-card:hover { border-color: var(--primary); background: white; transform: translateY(-3px); }

        /* --- CREATIVE RECEIPT STYLE --- */
        .receipt-container {
            background: white;
            padding: 40px 30px;
            border-radius: 5px;
            box-shadow: 0 0 20px rgba(0,0,0,0.05);
            position: relative;
            color: #333;
            min-height: 600px;
        }
        
        /* ZigZag Edge Effect */
        .receipt-container::after {
            content: "";
            position: absolute;
            bottom: -10px; left: 0;
            width: 100%; height: 10px;
            background: linear-gradient(-45deg, white 5px, transparent 0), linear-gradient(45deg, white 5px, transparent 0);
            background-size: 10px 10px;
        }

        .receipt-header { text-align: center; margin-bottom: 20px; }
        .receipt-header h1 { font-family: 'Outfit', sans-serif; font-weight: 800; color: #000; letter-spacing: -1px; }
        .receipt-header p { font-size: 12px; color: #666; line-height: 1.4; }

        .receipt-table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        .receipt-table th { border-bottom: 1px dashed #000; padding: 10px 0; text-align: left; font-size: 13px; text-transform: uppercase; }
        .receipt-table td { padding: 8px 0; font-size: 14px; font-family: 'Courier Prime', monospace; }

        .receipt-total-section { border-top: 1px dashed #000; padding-top: 15px; margin-top: 10px; }
        .total-row { display: flex; justify-content: space-between; margin-bottom: 5px; }
        .total-row.grand { font-weight: 800; font-size: 18px; border-top: 1px solid #eee; padding-top: 10px; margin-top: 10px; }

        /* --- BUTTONS --- */
        input, select { width: 100%; padding: 12px; margin: 8px 0; border: 2px solid #f1f2f6; border-radius: 12px; }
        .btn { padding: 12px 25px; border: none; border-radius: 12px; cursor: pointer; font-weight: 700; width: 100%; }
        .btn-primary { background: var(--primary); color: white; margin-top: 20px; }
        .btn-add { background: var(--secondary); color: white; }

        /* --- PRINT CONFIG --- */
        @media print {
            body { background: white; }
            #sidebar, #main-content > section:not(#billing), .product-selector, .no-print, .nav-link { display: none !important; }
            #main-content { padding: 0; }
            .billing-container { grid-template-columns: 1fr; }
            .receipt-container { box-shadow: none; border: none; width: 100%; max-width: 400px; margin: 0 auto; padding: 10px; }
            .receipt-container::after { display: none; }
        }
    </style>
</head>
<body>

    <div id="auth-screen">
        <div class="auth-card">
            <h1 style="font-size: 40px;">üçì</h1>
            <h2>Hasaral Juice POS</h2>
            <p style="color: #666; margin-bottom: 20px;">Please login to continue</p>
            <input type="text" id="login-user" placeholder="Username">
            <input type="password" id="login-pass" placeholder="Password">
            <button class="btn btn-primary" onclick="handleAuth()">Unlock System</button>
            <p style="font-size: 12px; margin-top: 15px; color: #aaa;">Default: admin / 123</p>
        </div>
    </div>

    <aside id="sidebar">
        <div style="margin-bottom: 40px; text-align: center;">
            <h2 style="color: var(--secondary);">HASARAL</h2>
            <p style="font-size: 12px; opacity: 0.6;">FRUITS & JUICE BAR</p>
        </div>
        <div class="nav-link active" onclick="nav('dashboard')">üìä Dashboard</div>
        <div class="nav-link" onclick="nav('billing')">üßæ Billing</div>
        <div class="nav-link" onclick="nav('products')">üçé Inventory</div>
        <div class="nav-link" onclick="nav('reports')">üìú Reports</div>
        <div class="nav-link" onclick="nav('staff')">üë• Staff</div>
        <div class="nav-link" style="margin-top: auto; color: var(--primary);" onclick="location.reload()">üîí Logout</div>
    </aside>

    <main id="main-content">
        
        <section id="dashboard" class="page active">
            <div class="stat-grid">
                <div class="stat-card"><h4>Today's Sales</h4><h2 id="dash-income">LKR 0</h2></div>
                <div class="stat-card"><h4>Orders Today</h4><h2 id="dash-bills">0</h2></div>
                <div class="stat-card"><h4>Items Sold</h4><h2 id="dash-prods">0</h2></div>
            </div>
            <div class="chart-box">
                <h3 style="margin-bottom: 20px;">Income Trend (7 Days)</h3>
                <canvas id="salesChart" height="100"></canvas>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div class="stat-card"><h3>Recently Added</h3><div id="recent-list"></div></div>
                <div class="stat-card"><h3>Daily Performance</h3><p id="perf-msg">No sales yet today.</p></div>
            </div>
        </section>

        <section id="billing" class="page">
            <div class="billing-container">
                <div class="product-selector">
                    <h3 style="margin-bottom: 15px;">Menu Items</h3>
                    <div id="cat-tabs" style="display: flex; gap: 10px; margin-bottom: 20px; overflow-x: auto;"></div>
                    <div class="item-grid" id="bill-grid"></div>
                </div>

                <div class="receipt-container" id="printable-receipt">
                    <div class="receipt-header">
                        <h1>HASARAL</h1>
                        <p>FRUITS & JUICE BAR</p>
                        <p>No. 134, Kegalle Road, Polgahawela</p>
                        <p>Tel: 0779219372</p>
                        <p style="margin-top: 10px; font-family: 'Courier Prime'; font-size: 11px;">
                            ID: <span id="bill-id-display">INV-0000</span> | Date: <span id="bill-date-display">--/--/--</span>
                        </p>
                    </div>

                    <table class="receipt-table">
                        <thead><tr><th>Item</th><th>Qty</th><th>Price</th></tr></thead>
                        <tbody id="receipt-body"></tbody>
                    </table>

                    <div class="receipt-total-section">
                        <div class="total-row"><span>Subtotal</span><span id="rec-sub">0.00</span></div>
                        <div class="total-row"><span>Discount (%)</span><input type="number" id="rec-disc" value="0" style="width: 50px; padding: 2px; text-align: right;" oninput="calculateTotal()"></div>
                        <div class="total-row grand"><span>TOTAL</span><span id="rec-total">LKR 0.00</span></div>
                    </div>

                    <center>
                        <div id="qrcode" style="margin-top: 25px;"></div>
                        <p style="font-size: 11px; margin-top: 15px; font-family: 'Courier Prime';">Thank you for your visit!<br>Come back for fresh juices!</p>
                        <button class="btn btn-primary no-print" onclick="processSale()">Print & Complete Sale</button>
                    </center>
                </div>
            </div>
        </section>

        <section id="products" class="page">
            <div style="display: grid; grid-template-columns: 320px 1fr; gap: 25px;">
                <div class="stat-card">
                    <h3>Add Product</h3>
                    <input type="hidden" id="edit-id">
                    <input type="text" id="p-name" placeholder="Juice Name">
                    <input type="number" id="p-price" placeholder="Price (LKR)">
                    <select id="p-cat"></select>
                    <button class="btn btn-add" onclick="saveProduct()">Save Product</button>
                    <hr style="margin: 20px 0;">
                    <h3>New Category</h3>
                    <input type="text" id="new-cat" placeholder="Category Name">
                    <button class="btn" onclick="addCat()">Add Category</button>
                </div>
                <table style="width: 100%; background: white; border-radius: 15px; border-collapse: collapse;">
                    <thead style="background: #f8f9fa;"><tr><th style="padding: 15px;">Item</th><th>Category</th><th>Price</th><th>Action</th></tr></thead>
                    <tbody id="inventory-table"></tbody>
                </table>
            </div>
        </section>

        <section id="staff" class="page">
            <div style="display: grid; grid-template-columns: 320px 1fr; gap: 25px;">
                <div class="stat-card">
                    <h3>New Staff Account</h3>
                    <input type="text" id="st-user" placeholder="Username">
                    <input type="password" id="st-pass" placeholder="Password">
                    <button class="btn btn-add" onclick="addStaff()">Create User</button>
                </div>
                <div id="staff-list-grid"></div>
            </div>
        </section>

        <section id="reports" class="page">
            <div class="stat-card" style="margin-bottom: 20px;">
                <input type="text" id="search-bill" placeholder="Search by Bill ID..." onkeyup="filterReports()">
            </div>
            <table style="width: 100%; background: white; border-radius: 15px;">
                <thead><tr><th style="padding:15px;">Bill ID</th><th>Date</th><th>Total</th><th>Items</th></tr></thead>
                <tbody id="report-table"></tbody>
            </table>
        </section>

    </main>

    <script>
        // --- STORAGE & STATE ---
        let products = JSON.parse(localStorage.getItem('h_products')) || [];
        let categories = JSON.parse(localStorage.getItem('h_categories')) || ['Fresh Juice', 'Smoothies', 'Fruit Salads'];
        let sales = JSON.parse(localStorage.getItem('h_sales')) || [];
        let users = JSON.parse(localStorage.getItem('h_users')) || [{u: 'admin', p: '123'}];
        let cart = [];
        let currentFilter = 'All';

        // --- AUTH ---
        function handleAuth() {
            const u = document.getElementById('login-user').value;
            const p = document.getElementById('login-pass').value;
            if(users.find(user => user.u === u && user.p === p)) {
                document.getElementById('auth-screen').style.display = 'none';
                init();
            } else { alert("Login Failed!"); }
        }

        // --- NAVIGATION ---
        function nav(id) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            event.currentTarget.classList.add('active');
            if(id === 'dashboard') updateDashboard();
            if(id === 'billing') renderBilling();
            if(id === 'products') renderInventory();
            if(id === 'staff') renderStaff();
            if(id === 'reports') renderReports();
        }

        // --- BILLING LOGIC ---
        function renderBilling() {
            const tabs = document.getElementById('cat-tabs');
            tabs.innerHTML = `<button class="btn" style="width:auto; margin-right:10px" onclick="setBillFilter('All')">All</button>`;
            categories.forEach(c => tabs.innerHTML += `<button class="btn" style="width:auto; margin-right:10px; background:#eee; color:#333;" onclick="setBillFilter('${c}')">${c}</button>`);
            
            const grid = document.getElementById('bill-grid');
            const items = currentFilter === 'All' ? products : products.filter(p => p.cat === currentFilter);
            grid.innerHTML = items.map(p => `<div class="item-card" onclick="addToCart(${p.id})"><b>${p.name}</b><br><small>LKR ${p.price}</small></div>`).join('');
            
            document.getElementById('bill-date-display').innerText = new Date().toLocaleDateString();
        }

        function setBillFilter(f) { currentFilter = f; renderBilling(); }

        function addToCart(id) {
            const p = products.find(i => i.id == id);
            const exists = cart.find(i => i.id == id);
            if(exists) exists.qty++; else cart.push({...p, qty: 1});
            updateCartUI();
        }

        function updateCartUI() {
            const body = document.getElementById('receipt-body');
            body.innerHTML = cart.map(i => `<tr><td>${i.name}</td><td>${i.qty}</td><td>${(i.qty * i.price).toFixed(2)}</td></tr>`).join('');
            calculateTotal();
        }

        function calculateTotal() {
            const sub = cart.reduce((s, i) => s + (i.qty * i.price), 0);
            const disc = document.getElementById('rec-disc').value;
            const total = sub - (sub * (disc/100));
            document.getElementById('rec-sub').innerText = sub.toFixed(2);
            document.getElementById('rec-total').innerText = total.toFixed(2);
        }

        function processSale() {
            if(cart.length === 0) return alert("Select items first!");
            
            const billId = "INV-" + Date.now().toString().slice(-6);
            document.getElementById('bill-id-display').innerText = billId;
            
            // Generate QR
            document.getElementById('qrcode').innerHTML = "";
            new QRCode(document.getElementById("qrcode"), { text: billId, width: 80, height: 80 });

            setTimeout(() => {
                window.print();
                sales.push({
                    id: billId,
                    date: new Date().toLocaleDateString(),
                    items: cart.map(i => `${i.name} (${i.qty})`).join(', '),
                    total: parseFloat(document.getElementById('rec-total').innerText)
                });
                localStorage.setItem('h_sales', JSON.stringify(sales));
                cart = [];
                updateCartUI();
                document.getElementById('rec-disc').value = 0;
            }, 500);
        }

        // --- DASHBOARD ---
        function updateDashboard() {
            const today = new Date().toLocaleDateString();
            const todaySales = sales.filter(s => s.date === today);
            const income = todaySales.reduce((a, b) => a + b.total, 0);
            
            document.getElementById('dash-income').innerText = `LKR ${income.toFixed(2)}`;
            document.getElementById('dash-bills').innerText = todaySales.length;
            document.getElementById('dash-prods').innerText = products.length;

            document.getElementById('recent-list').innerHTML = products.slice(-4).map(p => `<p>üÜï ${p.name} - ${p.price}</p>`).join('');
            renderChart();
        }

        function renderChart() {
            const ctx = document.getElementById('salesChart').getContext('2d');
            const dates = [...Array(7)].map((_, i) => {
                let d = new Date(); d.setDate(d.getDate() - i); return d.toLocaleDateString();
            }).reverse();
            const data = dates.map(d => sales.filter(s => s.date === d).reduce((a, b) => a + b.total, 0));

            if(window.myChart) window.myChart.destroy();
            window.myChart = new Chart(ctx, {
                type: 'bar',
                data: { labels: dates, datasets: [{ label: 'Income', data: data, backgroundColor: '#2ED573', borderRadius: 8 }] },
                options: { responsive: true, plugins: { legend: { display: false } } }
            });
        }

        // --- STAFF MGMT ---
        function addStaff() {
            const u = document.getElementById('st-user').value;
            const p = document.getElementById('st-pass').value;
            if(u && p) {
                users.push({u, p});
                localStorage.setItem('h_users', JSON.stringify(users));
                document.getElementById('st-user').value = '';
                document.getElementById('st-pass').value = '';
                renderStaff();
            }
        }

        function renderStaff() {
            const container = document.getElementById('staff-list-grid');
            container.innerHTML = users.map((u, i) => `
                <div class="stat-card" style="margin-bottom:10px; display:flex; justify-content:space-between;">
                    <span><b>${u.u}</b></span>
                    ${i === 0 ? '<i>Admin</i>' : `<button onclick="delStaff(${i})" style="color:red; background:none; border:none; cursor:pointer">Remove</button>`}
                </div>
            `).join('');
        }
        function delStaff(i) { users.splice(i, 1); localStorage.setItem('h_users', JSON.stringify(users)); renderStaff(); }

        // --- INVENTORY MGMT ---
        function addCat() {
            const c = document.getElementById('new-cat').value;
            if(c) { categories.push(c); localStorage.setItem('h_categories', JSON.stringify(categories)); document.getElementById('new-cat').value=''; renderInventory(); }
        }

        function saveProduct() {
            const name = document.getElementById('p-name').value;
            const price = document.getElementById('p-price').value;
            const cat = document.getElementById('p-cat').value;
            if(!name || !price) return;
            products.push({id: Date.now(), name, price, cat});
            localStorage.setItem('h_products', JSON.stringify(products));
            document.getElementById('p-name').value = ''; document.getElementById('p-price').value = '';
            renderInventory();
        }

        function renderInventory() {
            const body = document.getElementById('inventory-table');
            document.getElementById('p-cat').innerHTML = categories.map(c => `<option value="${c}">${c}</option>`).join('');
            body.innerHTML = products.map((p, i) => `<tr><td style="padding:15px">${p.name}</td><td>${p.cat}</td><td>${p.price}</td><td><button onclick="delProd(${i})" style="color:red; background:none; border:none; cursor:pointer">Delete</button></td></tr>`).join('');
        }
        function delProd(i) { products.splice(i,1); localStorage.setItem('h_products', JSON.stringify(products)); renderInventory(); }

        // --- REPORTS ---
        function renderReports() {
            const body = document.getElementById('report-table');
            body.innerHTML = sales.slice().reverse().map(s => `<tr><td style="padding:15px"><b>${s.id}</b></td><td>${s.date}</td><td>${s.total}</td><td><small>${s.items}</small></td></tr>`).join('');
        }
        function filterReports() {
            const q = document.getElementById('search-bill').value.toUpperCase();
            const filtered = sales.filter(s => s.id.includes(q));
            document.getElementById('report-table').innerHTML = filtered.map(s => `<tr><td style="padding:15px"><b>${s.id}</b></td><td>${s.date}</td><td>${s.total}</td><td><small>${s.items}</small></td></tr>`).join('');
        }

        function init() {
            updateDashboard();
        }
    </script>
</body>
</html>